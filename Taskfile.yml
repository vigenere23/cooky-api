version: '3'

tasks:
  build:
    deps:
      - build:app
      - build:ui
      - build:db

  build:app:
    cmds:
      - docker compose build app
    sources:
      - 'app/**/*.*'

  build:ui:
    cmds:
      - docker compose build ui
    sources:
      - 'ui/**/*.*'

  build:db:
    cmds:
      - docker compose build db
    sources:
      - 'db/**/*.*'

  up:
    cmds:
      - docker compose up --remove-orphans
    deps:
      - down
      - build

  up:db:
    cmds:
      - docker compose up --remove-orphans db
    deps:
      - down
      - build:db

  down:
    cmds:
      - docker compose down -t 15
